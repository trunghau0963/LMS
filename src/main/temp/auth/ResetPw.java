/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package com.lms.auth.form;

import java.awt.CardLayout;

import com.formdev.flatlaf.FlatClientProperties;
import com.lms.dashboard.application.Application;
import com.lms.auth.entities.Admin;
import com.lms.auth.entities.User;
import com.lms.auth.service.AuthService;

// import raven.toast.Notifications;

/**
 *
 * @author nttha
 */
public class ResetPw extends javax.swing.JPanel {
    private AuthService authService;
    private User user;
    /**
     * Creates new form ResetPw
     */
    public ResetPw(AuthService authService) {
        initComponents();
        init();
        this.authService = authService;
    }


    private void init() {
        txtPhoneNumber.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Enter your phone number");
        txtNewPw.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Enter your new password");
        txtVerifyNewPw.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Verify your new password");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panelForgotPw = new javax.swing.JPanel();
        forgotPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        signUptxt1 = new javax.swing.JLabel();
        signUpChangeButton1 = new javax.swing.JButton();
        txtPhoneNumber = new javax.swing.JTextField();
        searchAccountButton = new javax.swing.JButton();
        turnBackButton = new javax.swing.JButton();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel2 = new javax.swing.JLabel();
        errorFindAccount = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        panelVerify = new com.lms.auth.ui.PanelTransparent();
        verifyPanel = new javax.swing.JPanel();
        resetPwTitle = new javax.swing.JLabel();
        txtNewPw = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        txtVerifyNewPw = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        changePwButton = new javax.swing.JButton();
        errorNewPw = new javax.swing.JLabel();
        errorVerify = new javax.swing.JLabel();
        userNameSearched = new javax.swing.JLabel();

        setLayout(new java.awt.CardLayout());

        panelForgotPw.setOpaque(false);

        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 34)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("Forgot Password");

        signUptxt1.setText("Donâ€™t have accout ?");

        signUpChangeButton1.setText("Sign Up");
        signUpChangeButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                signUpChangeButton1ActionPerformed(evt);
            }
        });

        searchAccountButton.setBackground(new java.awt.Color(64, 68, 237));
        searchAccountButton.setForeground(new java.awt.Color(255, 255, 255));
        searchAccountButton.setText("Search");
        searchAccountButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchAccountButtonActionPerformed(evt);
            }
        });

        turnBackButton.setBackground(new java.awt.Color(255, 112, 8));
        turnBackButton.setText("Go back");
        turnBackButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                turnBackButtonActionPerformed(evt);
            }
        });

        jLabel2.setText("Phone Number");

        errorFindAccount.setForeground(new java.awt.Color(255, 0, 51));
        errorFindAccount.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);

        jLabel6.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel6.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel6.setText("Admin Only");

        javax.swing.GroupLayout forgotPanel1Layout = new javax.swing.GroupLayout(forgotPanel1);
        forgotPanel1.setLayout(forgotPanel1Layout);
        forgotPanel1Layout.setHorizontalGroup(
            forgotPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(txtPhoneNumber)
            .addComponent(searchAccountButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(turnBackButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(forgotPanel1Layout.createSequentialGroup()
                .addGroup(forgotPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(forgotPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 96, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(errorFindAccount, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(forgotPanel1Layout.createSequentialGroup()
                        .addGroup(forgotPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(forgotPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 298, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(forgotPanel1Layout.createSequentialGroup()
                                .addGap(41, 41, 41)
                                .addComponent(signUptxt1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(signUpChangeButton1))
                            .addGroup(forgotPanel1Layout.createSequentialGroup()
                                .addGap(54, 54, 54)
                                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 182, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(forgotPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jLabel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addContainerGap())
        );
        forgotPanel1Layout.setVerticalGroup(
            forgotPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(forgotPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel6)
                .addGap(30, 30, 30)
                .addGroup(forgotPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(errorFindAccount))
                .addGap(7, 7, 7)
                .addComponent(txtPhoneNumber, javax.swing.GroupLayout.PREFERRED_SIZE, 44, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(33, 33, 33)
                .addComponent(searchAccountButton, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(turnBackButton, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 23, Short.MAX_VALUE)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(forgotPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(signUptxt1)
                    .addComponent(signUpChangeButton1))
                .addGap(28, 28, 28))
        );

        javax.swing.GroupLayout panelForgotPwLayout = new javax.swing.GroupLayout(panelForgotPw);
        panelForgotPw.setLayout(panelForgotPwLayout);
        panelForgotPwLayout.setHorizontalGroup(
            panelForgotPwLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelForgotPwLayout.createSequentialGroup()
                .addGap(0, 325, Short.MAX_VALUE)
                .addComponent(forgotPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 325, Short.MAX_VALUE))
        );
        panelForgotPwLayout.setVerticalGroup(
            panelForgotPwLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelForgotPwLayout.createSequentialGroup()
                .addGap(0, 71, Short.MAX_VALUE)
                .addComponent(forgotPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 72, Short.MAX_VALUE))
        );

        add(panelForgotPw, "card2");

        resetPwTitle.setFont(new java.awt.Font("Segoe UI", 1, 36)); // NOI18N
        resetPwTitle.setForeground(new java.awt.Color(255, 255, 255));
        resetPwTitle.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        resetPwTitle.setText("Reset Password  ");

        jLabel4.setText("New Password");

        jLabel5.setText("Verify new password");

        changePwButton.setBackground(new java.awt.Color(64, 68, 237));
        changePwButton.setForeground(new java.awt.Color(255, 255, 255));
        changePwButton.setText("Continue");
        changePwButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                changePwButtonActionPerformed(evt);
            }
        });

        errorNewPw.setForeground(new java.awt.Color(255, 0, 0));
        errorNewPw.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);

        errorVerify.setForeground(new java.awt.Color(255, 0, 0));
        errorVerify.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);

        userNameSearched.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        userNameSearched.setForeground(new java.awt.Color(255, 255, 255));
        userNameSearched.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        userNameSearched.setText("jLabel3");

        javax.swing.GroupLayout verifyPanelLayout = new javax.swing.GroupLayout(verifyPanel);
        verifyPanel.setLayout(verifyPanelLayout);
        verifyPanelLayout.setHorizontalGroup(
            verifyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(txtNewPw)
            .addComponent(txtVerifyNewPw)
            .addComponent(changePwButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(verifyPanelLayout.createSequentialGroup()
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(errorVerify, javax.swing.GroupLayout.DEFAULT_SIZE, 196, Short.MAX_VALUE))
            .addGroup(verifyPanelLayout.createSequentialGroup()
                .addGroup(verifyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(verifyPanelLayout.createSequentialGroup()
                        .addComponent(jLabel4, javax.swing.GroupLayout.PREFERRED_SIZE, 90, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(errorNewPw, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(verifyPanelLayout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(verifyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(resetPwTitle, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(userNameSearched, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                .addContainerGap())
        );
        verifyPanelLayout.setVerticalGroup(
            verifyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(verifyPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(resetPwTitle)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(userNameSearched)
                .addGap(30, 30, 30)
                .addGroup(verifyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(errorNewPw))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtNewPw, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(14, 14, 14)
                .addGroup(verifyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(errorVerify))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtVerifyNewPw, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(36, 36, 36)
                .addComponent(changePwButton, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(56, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout panelVerifyLayout = new javax.swing.GroupLayout(panelVerify);
        panelVerify.setLayout(panelVerifyLayout);
        panelVerifyLayout.setHorizontalGroup(
            panelVerifyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelVerifyLayout.createSequentialGroup()
                .addGap(326, 326, 326)
                .addComponent(verifyPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(323, Short.MAX_VALUE))
        );
        panelVerifyLayout.setVerticalGroup(
            panelVerifyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, panelVerifyLayout.createSequentialGroup()
                .addContainerGap(80, Short.MAX_VALUE)
                .addComponent(verifyPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(80, 80, 80))
        );

        add(panelVerify, "card3");
    }// </editor-fold>//GEN-END:initComponents

    private void signUpChangeButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_signUpChangeButton1ActionPerformed
        Application.signUp();
    }//GEN-LAST:event_signUpChangeButton1ActionPerformed

    private void turnBackButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_turnBackButtonActionPerformed
        Application.login();
    }//GEN-LAST:event_turnBackButtonActionPerformed

    private void searchAccountButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchAccountButtonActionPerformed
        String userSearch = txtPhoneNumber.getText().trim();
        boolean action = true;

        if (userSearch.equals("")) {
            errorFindAccount.setText("Please input user phone number");
            errorFindAccount.setForeground(new java.awt.Color(255, 0, 0));
            txtPhoneNumber.grabFocus();
            action = false;
        }
        if (!userSearch.equals("")) {
            errorFindAccount.setText("");
        }

        if(action){
            user = authService.forgotPasswordAdmin(userSearch);
            if (user.getId() != null) {
                System.out.println("User found" + user.getId() + " " + user.getPhoneNumber());
                CardLayout cardLayout = (CardLayout) this.getLayout();
                cardLayout.show(this, "card3");
                userNameSearched.setText("For " + user.getName());
                // Notifications.getInstance().show(Notifications.Type.SUCCESS, Notifications.Location.TOP_CENTER,
                //         "Welcome " + user.getName());
            } else {
                errorFindAccount.setText("User not found");
                errorFindAccount.setForeground(new java.awt.Color(255, 0, 0));
                errorFindAccount.grabFocus();
                // Notifications.getInstance().show(Notifications.Type.ERROR, Notifications.Location.TOP_CENTER,
                //         "User not found");
            }
        }

    }//GEN-LAST:event_searchAccountButtonActionPerformed

    private void changePwButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_changePwButtonActionPerformed
        String newPw = txtNewPw.getText().trim();
        String verifyPw = txtVerifyNewPw.getText().trim();
        boolean action = true;

        if (newPw.equals("")) {
            errorNewPw.setText("Please input new password");
            errorNewPw.setForeground(new java.awt.Color(255, 0, 0));
            txtNewPw.grabFocus();
            action = false;
        }
        if (!newPw.equals("")) {
            errorNewPw.setText("");
        }

        if (verifyPw.equals("")) {
            errorVerify.setText("Please input verify password");
            errorVerify.setForeground(new java.awt.Color(255, 0, 0));
            txtVerifyNewPw.grabFocus();
            action = false;
        }
        if (!verifyPw.equals("")) {
            errorVerify.setText("");
        }

        if (!newPw.equals(verifyPw)) {
            errorNewPw.setText("Verify password not match");
            errorNewPw.setForeground(new java.awt.Color(255, 0, 0));
            txtVerifyNewPw.grabFocus();
            action = false;
            // Notifications.getInstance().show(Notifications.Type.ERROR, Notifications.Location.TOP_CENTER,
            //         "Verify password not match");
        }
        if (newPw.equals(verifyPw)) {
            errorNewPw.setText("");
        }
        Admin admin = new Admin();
        if(action){
            admin = (Admin) authService.updatePassword(user, newPw);
            System.out.println("Admin pw" + admin.getPwd());
            if (newPw.equals(admin.getPwd())) {
                // Notifications.getInstance().show(Notifications.Type.SUCCESS, Notifications.Location.TOP_CENTER,
                //         "Password updated");
                System.out.println("Password updated");
                Application.login();
            } else {
                // Notifications.getInstance().show(Notifications.Type.ERROR, Notifications.Location.TOP_CENTER,
                //         "Password not updated");
            }
        }
    }//GEN-LAST:event_changePwButtonActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton changePwButton;
    private javax.swing.JLabel errorFindAccount;
    private javax.swing.JLabel errorNewPw;
    private javax.swing.JLabel errorVerify;
    private javax.swing.JPanel forgotPanel1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JPanel panelForgotPw;
    private com.lms.auth.ui.PanelTransparent panelVerify;
    private javax.swing.JLabel resetPwTitle;
    private javax.swing.JButton searchAccountButton;
    private javax.swing.JButton signUpChangeButton1;
    private javax.swing.JLabel signUptxt1;
    private javax.swing.JButton turnBackButton;
    private javax.swing.JTextField txtNewPw;
    private javax.swing.JTextField txtPhoneNumber;
    private javax.swing.JTextField txtVerifyNewPw;
    private javax.swing.JLabel userNameSearched;
    private javax.swing.JPanel verifyPanel;
    // End of variables declaration//GEN-END:variables
    
}
